# LavaMiningTest

## Описание
Тестовая сцена, где бегает ГГ, собирает ресурсы (источники и споты (заводы))

Источники:
- дерево
- металл
- кристалл

Споты:
- монеты (требует дерево, металл и кристалл)
- мясо (требует монеты)
  
## Управление
Управление происходит (*PlayerInput*):
- сенсорно (через обычный *Input.touch*)
- если в редакторе, то через клавиатуру (WASD или стрелочки)

Перемещение ГГ (*PlayerController*) осуществлено через *NavMeshAgent*

## Задача 1 - Добыча ресурсов
- на сцене есть 3 источника
  - дерево - для добычи древесины
  - стол кузнеца - для добычи металла
  - булыжник с рудой - для добычи кристаллов
- ГГ добывает ресурсы (*ResourceBehaviour*) в источниках (*SourceBehaviour*)
- ГГ добывает ресурсы, когда:
  - расположен близко к источнику (*MinerController*)
  - не перемещается
- ресурсы выпадают с анимацией (использовалось *DOTween*)
- ресурсы доступны для сбора игроком через определенное время
- у источника/спота при выпадении ресурса проигрывается анимация (также *DOTween*)
- когда источник/спот исчерпан, то он становится недоступным. происходит "восстановление" ресурсов
  
## Задача 2 - Споты
- на сцене есть 2 спота
  - ящики с монетами - для добычи монет
  - повозка с мясом - для добычи мяса
- ГГ сбрасывает ресурсы в спот (*SpotBehaviour*)
- ГГ сбрасывает ресурсы, когда:
  - расположен близко к споту (*DistributorController*)
  - не перемещается
- ресурсы сбрасываются с заданным интервалом (поочередно, а не все разом)
- спот после получения необходимых ресурсов, становится недоступным и начинает "производство" своего ресурса
- ресурсы из спота выпадают также, как и у источника

## Задача 3 - UI
- отображаются все ресурсы имеющиеся у игрока (если 0, то не отображается)
- отображаются необходимые ресурсы для спотов
- добыча/сброс ресурсов сопровождается анимацией (снова привет *DOTween*)
- ресурсы хранятся на сцене, а также происходит сохранение данных на устройство (подробнее будет ниже)

## Задача 4 - Туториал
- отображаются линии до источников/спотом, которыми нужно воспользоваться
- логика отображения линий следующая:
  - указан финальный целевой ресурс - в данном случае это мясо
  - на сцене выбираются те источники/споты, которые производят данный ресурс
  - проверяется наличие в инвентаре ГГ необходимых ресурсов (если для спота)
    - если ресурсы есть, то линия указывает до спота
    - если ресурсов недостаточно, то меняется целевой ресурс, процесс повторяется
  - если ресурсы не нужны (то есть нужно идти к источнику), то линия показывает на источник
- в UI есть кнопка, которая включает и выключает линии

## Настройки

*ResourceProfile* - настройка ресурса
- префаб с *ResourceBehaviour*
- иконка ресурса (будет отображаться в UI)
- имя, описание
- настройка эффектов

![resource]

*SourceProfile* - настройка источника
- кол-во выпадаемых ресурсов за один раз
- профиль выпадаемого ресурса
- задержка между выпаданием ресурсов (если за один раз вылетает несколько штук)
- максимальное кол-во ресурсов в источнике
- частота добычи
- время восстановления максимального кол-ва ресурсов
- (только для чтения) значение добычи ресурсов в секунду (рассчитывается на основании вышеуказанных данных)

![source]

*SpotProfile*
- кол-во выпадаемых ресурсов за один раз
- профиль выпадаемого ресурса
- задержка между выпаданием ресурсов (если за один раз вылетает несколько штук)
- длительность создание своего ресурса
- время восстановления спота после производства ресурса
- профиль с настройкой необходимых ресурсов

![spot]

*RequiredResourceProfile* - настройка необходимых ресурсов
- список ресурсов
  - кол-во 
  - профиль ресурса
  
![required]

*ResourceEffectProfile* - настройка эффектов ресурса
- радиус разброса появления ресурса
- высота подъема ресурса при появлении (аля импульс вверх)
- длительность подъема ресурса на высоту
- сила Shake (для *DOTween*)
- длительность перемещения для финальный точки сброса
- задержка после которой ресурс становится доступный для подбора игроком
- длительность перемещения ресурса в инвентарь игрока после его подбора

![effect]

[resource]:README/resource.png
[source]:README/source.png
[spot]:README/spot.png
[required]:README/required.png
[effect]:README/effect.png

### Сейвы

Сохранение инвентаря производится *DataInventoryStorage*.
- загрузка происходит в *async OnEnable*
- сохранение в *async OnDisable*
- с заданной периодичностью происходит автосохранение
- для построения пути сохранения файла использовался *Application.persistentDataPath*
- название файла сохранения формируется с помощью:
  - имени игрока
  - имени сцены
  - названия типа сохраняемых данных (в данном случае инвентаря)
- в качестве формата данных использовался json, сохраняется в обычный json
- для записи/чтения используется *FileInfo* и *StreamWriter*

## Архитектурные особенности
- камера - *Cinemachine*
- эффекты - *DOTween*
- все изменяемые параметры вынесены в инспектор и/или в *ScriptableObject*
- есть возможность менять загружаемую модельку игрока (*PlayerModelLoader*) т.к. модель не привязана к логике поведения игрока
- в качестве некоторых моделей были использованы бесплатные ассеты
- архитектура источников/спотов довольно расширяема
  - споты/источники хранят свои профили, что позволяет менять их поведение, не вмешиваясь в их префабы
  - необходимые ресурсы для спотом настраиваются также отдельно
- благодаря текущему формированию имени сохраняемого файла возможно сохранение инвентаря в зависимости от игрока и от сцены/уровня игры
- минимизированы чрезмерное использование тяжелых функций FindObject/GetComponent (*ComponentCache*)